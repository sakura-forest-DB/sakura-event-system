# Forest Christmas 2025 セットアップガイド

このガイドでは、「Forest Christmas 2025」イベントを正常に動作させるための手順を説明します。

## 前提条件

- Render環境にデプロイ済み
- PostgreSQLデータベースが接続済み
- 環境変数が正しく設定されている

## セットアップ手順

### 1. イベントの作成

Render環境で管理画面からイベントを作成します。

#### 管理画面へのアクセス

1. ブラウザで管理画面にアクセス
   ```
   https://your-app.onrender.com/admin
   ```

2. Basic認証でログイン
   - ユーザー名: 環境変数 `ADMIN_USER` の値
   - パスワード: 環境変数 `ADMIN_PASS` の値

#### イベントの作成

1. 管理画面で「イベント管理」→「イベント作成」をクリック

2. 以下の情報を入力：
   - **イベント名**: `Forest Christmas 2025`
   - **スラッグ**: `forest-christmas-2025`
   - **開催日時**: `2025-12-21T10:00:00+09:00` (2025年12月21日 10:00)
   - **申込開始日**: `2025-10-01T00:00:00+09:00` (2025年10月1日から)
   - **場所**: `菊名桜山公園`
   - **説明**: `菊名桜山公園で開催される特別なクリスマスイベントです。地域の皆様と一緒に素敵な時間を過ごしましょう。出店・出演の募集を行っています。`
   - **公開設定**: チェックを入れる（isPublic: true）
   - **ステータス**: `OPEN`

3. 「保存」をクリック

### 2. イベント作成の確認

作成が完了したら、以下を確認：

1. トップページ (`/`) にアクセス
   - 「Forest Christmas 2025」のヒーローセクションが表示される
   - 「募集中のイベント」セクションにイベントカードが表示される

2. ボタンの動作確認
   - 「🙋 ボランティア登録」ボタン → `/register` にリンク（正常動作）
   - 「🏪 出店申込」ボタン → `/apply/forest-christmas-2025/stall` にリンク
   - 「🎭 出演申込」ボタン → `/apply/forest-christmas-2025/performer` にリンク

### 3. 動作確認フロー

#### 出店申込フロー

1. トップページから「🏪 出店申込」をクリック
2. 出店申込フォームが表示される
3. 必要情報を入力して「確認画面へ」をクリック
4. 確認画面で内容を確認して「申し込む」をクリック
5. 完了画面が表示される
6. 管理画面 (`/admin/stalls`) で申込データを確認

#### 出演申込フロー

1. トップページから「🎭 出演申込」をクリック
2. 出演申込フォームが表示される
3. 必要情報を入力して「確認画面へ」をクリック
4. 確認画面で内容を確認して「申し込む」をクリック
5. 完了画面が表示される
6. 管理画面 (`/admin/performers`) で申込データを確認

#### ボランティア登録フロー

1. トップページから「🙋 ボランティア登録」をクリック
2. ボランティア登録フォームが表示される
3. 必要情報を入力して「確認画面へ」をクリック
4. 確認画面で内容を確認して「登録する」をクリック
5. 完了画面が表示される
6. 管理画面 (`/admin/volunteers`) で登録データを確認

### 4. 管理画面での確認

管理画面では以下の操作が可能です：

- **イベント管理** (`/admin/events`)
  - イベント一覧の表示
  - イベントの作成・編集・削除

- **出店申込管理** (`/admin/stalls`)
  - 出店申込一覧の表示
  - 申込詳細の確認
  - 申込情報の編集
  - CSVエクスポート

- **出演申込管理** (`/admin/performers`)
  - 出演申込一覧の表示
  - 申込詳細の確認
  - 申込情報の編集
  - CSVエクスポート

- **ボランティア管理** (`/admin/volunteers`)
  - ボランティア一覧の表示
  - ボランティア詳細の確認
  - ボランティア情報の編集
  - CSVエクスポート

## トラブルシューティング

### イベントが表示されない

1. データベースにイベントが正しく作成されているか確認
2. イベントの `isPublic` が `true` になっているか確認
3. イベントの `status` が `OPEN` になっているか確認
4. イベントの `date` が未来の日付になっているか確認

### 404エラーが発生する

1. イベントのスラッグが正しいか確認（`forest-christmas-2025`）
2. ルーティング設定が正しいか確認
3. アプリケーションが正常に起動しているか確認

### 申込データが保存されない

1. データベース接続を確認
2. Prismaスキーマが正しく反映されているか確認（`npx prisma db push`）
3. アプリケーションログでエラーを確認

## 技術仕様

### ファイル構成

- **views/partials/header.ejs**: ナビゲーションヘッダー（Forest Christmas 2025ブランド）
- **views/home.ejs**: トップページ（ヒーローセクション + イベント一覧）
- **routes/home.js**: トップページルーティング
- **routes/apply-stall.js**: 出店申込ルーティング
- **routes/apply-performer.js**: 出演申込ルーティング
- **routes/register.js**: ボランティア登録ルーティング
- **routes/admin.js**: 管理画面ルーティング

### データベーステーブル

- **events**: イベント情報
- **stall_applications**: 出店申込データ
- **performer_applications**: 出演申込データ
- **volunteers**: ボランティア登録データ
- **change_logs**: 変更履歴（監査ログ）

### URL構造

- `/` - トップページ
- `/register` - ボランティア登録
- `/apply/forest-christmas-2025/stall` - 出店申込
- `/apply/forest-christmas-2025/performer` - 出演申込
- `/admin` - 管理画面トップ
- `/admin/events` - イベント管理
- `/admin/stalls` - 出店申込管理
- `/admin/performers` - 出演申込管理
- `/admin/volunteers` - ボランティア管理

## デプロイ手順

### christmas-tempブランチからのデプロイ

1. 変更をコミット
   ```bash
   git add -A
   git commit -m "feat: Setup Forest Christmas 2025 event with complete workflow"
   ```

2. Renderにプッシュ
   ```bash
   git push origin christmas-temp
   ```

3. Render Dashboardでブランチを `christmas-temp` に変更
   - Settings → Branch → `christmas-temp` を選択
   - Save changes

4. 自動デプロイが開始される

5. デプロイ完了後、管理画面からイベントを作成

## まとめ

このセットアップガイドに従うことで、「Forest Christmas 2025」イベントが完全に動作する状態になります。

- ✅ トップページに「Forest Christmas 2025」が表示される
- ✅ 出店申込フォームが正常に動作する
- ✅ 出演申込フォームが正常に動作する
- ✅ 応募データがPostgreSQLに保存される
- ✅ 管理画面から応募データを確認できる
