<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .navbar-brand { font-weight: bold; color: #2d5a27 !important; }
        .bg-primary { background-color: #2d5a27 !important; }
        .btn-primary { background-color: #2d5a27; border-color: #2d5a27; }
        .btn-primary:hover { background-color: #1e3c1a; border-color: #1e3c1a; }
        footer { background-color: #f8f9fa; margin-top: auto; }
        .form-section { border-left: 4px solid #2d5a27; padding-left: 15px; margin-bottom: 2rem; }
        .required { color: #dc3545; }
        
        /* 出演申込用の薄いピンクの背景 */
        .performer-form-bg {
            background-color: #fce4ec;
        }
        .card-header.performer-header {
            background-color: #f8bbd9;
            border-bottom: 1px solid #f48fb1;
        }
        
        /* 出演申込フォーム内のアラート調整 */
        .performer-form-bg .alert-info {
            background-color: #f1c2d8;
            border-color: #e394b3;
            color: #8e2754;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">🌸 菊名桜山公園</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/register">ボランティア登録</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/apply">イベント申込</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin">管理画面</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header performer-header">
                        <h4 class="mb-0">🎭 出演申込フォーム</h4>
                        <small class="text-muted">応募要項B準拠</small>
                    </div>
                    <div class="card-body performer-form-bg">
                        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
                            <div class="alert alert-danger">
                                <ul class="mb-0">
                                    <% errors.forEach(error => { %>
                                        <li><%= error %></li>
                                    <% }); %>
                                </ul>
                            </div>
                        <% } %>

                        <form method="POST" action="/apply/performer">
                            <!-- 基本情報 -->
                            <div class="form-section">
                                <h5>📝 基本情報</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="groupName" class="form-label">参加団体名 <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="groupName" name="groupName" 
                                               value="<%= typeof formData !== 'undefined' ? formData.groupName || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="representative" class="form-label">代表者名 <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="representative" name="representative" 
                                               value="<%= typeof formData !== 'undefined' ? formData.representative || '' : '' %>" required>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">メールアドレス <span class="required">*</span></label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               value="<%= typeof formData !== 'undefined' ? formData.email || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">電話番号</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               value="<%= typeof formData !== 'undefined' ? formData.phone || '' : '' %>">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">住所</label>
                                    <textarea class="form-control" id="address" name="address" rows="2"><%= typeof formData !== 'undefined' ? formData.address || '' : '' %></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="eventId" class="form-label">イベント <span class="required">*</span></label>
                                    <select class="form-control" id="eventId" name="eventId" required>
                                        <option value="">イベントを選択してください</option>
                                        <% if (typeof events !== 'undefined' && events.length > 0) { %>
                                            <% events.forEach(event => { %>
                                                <option value="<%= event.id %>" 
                                                        <%= (typeof formData !== 'undefined' && formData.eventId === event.id) ? 'selected' : '' %>
                                                        <%= !event.canApply ? 'disabled' : '' %>>
                                                    <%= event.title %> - <%= new Date(event.date).toLocaleDateString('ja-JP') %>
                                                    <% if (!event.canApply && event.applicationStartMessage) { %>
                                                        (<%= event.applicationStartMessage %>)
                                                    <% } %>
                                                </option>
                                            <% }); %>
                                        <% } %>
                                    </select>
                                    <% if (typeof events !== 'undefined' && events.some(event => !event.canApply)) { %>
                                        <div class="form-text text-info">
                                            申込開始前のイベントは選択できません
                                        </div>
                                    <% } %>
                                </div>
                            </div>

                            <!-- 出演内容 -->
                            <div class="form-section">
                                <h5>🎭 出演内容</h5>
                                <div class="mb-3">
                                    <label for="performance" class="form-label">出演内容 <span class="required">*</span></label>
                                    <textarea class="form-control" id="performance" name="performance" rows="4" required
                                              placeholder="音楽、ダンス、演劇等の具体的な演目や内容をご記入ください"><%= typeof formData !== 'undefined' ? formData.performance || '' : '' %></textarea>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="performerCount" class="form-label">出演者数</label>
                                        <input type="number" class="form-control" id="performerCount" name="performerCount" min="1"
                                               value="<%= typeof formData !== 'undefined' ? formData.performerCount || '' : '' %>">
                                        <div class="form-text">実際にステージに上がる人数</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="slotCount" class="form-label">希望出演枠数</label>
                                        <input type="number" class="form-control" id="slotCount" name="slotCount" min="1" max="3"
                                               value="<%= typeof formData !== 'undefined' ? formData.slotCount || '' : '' %>">
                                        <div class="form-text">1枠約15分程度</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 音響・機材 -->
                            <div class="form-section">
                                <h5>🔊 音響・機材レンタル</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="rentalAmp" class="form-label">音源拡声装置レンタル希望数</label>
                                        <input type="number" class="form-control" id="rentalAmp" name="rentalAmp" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalAmp || '' : '' %>">
                                        <div class="form-text">スピーカー・アンプセット</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="rentalMic" class="form-label">追加マイク本数</label>
                                        <input type="number" class="form-control" id="rentalMic" name="rentalMic" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalMic || '' : '' %>">
                                        <div class="form-text">基本マイク以外の追加分</div>
                                    </div>
                                </div>

                                <div class="alert alert-info">
                                    <small>
                                        <strong>機材について：</strong><br>
                                        基本的な音響機材（マイク1本、アンプ1台）は無料で提供いたします。<br>
                                        追加機材については事前にご相談ください。
                                    </small>
                                </div>
                            </div>

                            <!-- 搬入搬出 -->
                            <div class="form-section">
                                <h5>🚚 搬入搬出</h5>
                                <div class="mb-3">
                                    <label for="vehicleCount" class="form-label">搬入・搬出車両台数</label>
                                    <input type="number" class="form-control" id="vehicleCount" name="vehicleCount" min="0"
                                           value="<%= typeof formData !== 'undefined' ? formData.vehicleCount || '' : '' %>">
                                    <div class="form-text">楽器・機材等の搬入・搬出を予定している車両台数</div>
                                </div>
                            </div>

                            <!-- 連絡事項 -->
                            <div class="form-section">
                                <h5>💬 連絡事項</h5>
                                <div class="mb-3">
                                    <label for="questions" class="form-label">ご質問・ご要望等</label>
                                    <textarea class="form-control" id="questions" name="questions" rows="4"
                                              placeholder="電源の確保、特別な機材、舞台設営等でご要望がございましたらご記入ください"><%= typeof formData !== 'undefined' ? formData.questions || '' : '' %></textarea>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="/apply" class="btn btn-secondary me-md-2">戻る</a>
                                <button type="submit" class="btn btn-primary">申込む</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="py-3 mt-4">
        <div class="container text-center text-muted">
            <p>&copy; 2025 菊名桜山公園 ボランティア管理システム</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>