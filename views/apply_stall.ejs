<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .navbar-brand { font-weight: bold; color: #2d5a27 !important; }
        .bg-primary { background-color: #2d5a27 !important; }
        .btn-primary { background-color: #2d5a27; border-color: #2d5a27; }
        .btn-primary:hover { background-color: #1e3c1a; border-color: #1e3c1a; }
        footer { background-color: #f8f9fa; margin-top: auto; }
        .form-section { border-left: 4px solid #2d5a27; padding-left: 15px; margin-bottom: 2rem; }
        .required { color: #dc3545; }
        
        /* Âá∫Â∫óÁî≥ËæºÁî®„ÅÆËñÑ„ÅÑÁ∑ë„ÅÆËÉåÊôØ */
        .stall-form-bg {
            background-color: #e8f5e8;
        }
        .card-header.stall-header {
            background-color: #c8e6c9;
            border-bottom: 1px solid #a5d6a7;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">üå∏ ËèäÂêçÊ°úÂ±±ÂÖ¨Âúí</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">„Éõ„Éº„É†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/register">„Éú„É©„É≥„ÉÜ„Ç£„Ç¢ÁôªÈå≤</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/apply">„Ç§„Éô„É≥„ÉàÁî≥Ëæº</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin">ÁÆ°ÁêÜÁîªÈù¢</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header stall-header">
                        <h4 class="mb-0">üè™ Âá∫Â∫óÁî≥Ëæº„Éï„Ç©„Éº„É†</h4>
                        <small class="text-muted">ÂøúÂãüË¶ÅÈ†ÖAÊ∫ñÊã†</small>
                    </div>
                    <div class="card-body stall-form-bg">
                        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
                            <div class="alert alert-danger">
                                <ul class="mb-0">
                                    <% errors.forEach(error => { %>
                                        <li><%= error %></li>
                                    <% }); %>
                                </ul>
                            </div>
                        <% } %>

                        <form method="POST" action="/apply/stall">
                            <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                            <div class="form-section">
                                <h5>üìù Âü∫Êú¨ÊÉÖÂ†±</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="groupName" class="form-label">ÂèÇÂä†Âõ£‰ΩìÂêç <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="groupName" name="groupName" 
                                               value="<%= typeof formData !== 'undefined' ? formData.groupName || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="representative" class="form-label">‰ª£Ë°®ËÄÖÂêç <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="representative" name="representative" 
                                               value="<%= typeof formData !== 'undefined' ? formData.representative || '' : '' %>" required>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="required">*</span></label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               value="<%= typeof formData !== 'undefined' ? formData.email || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">ÈõªË©±Áï™Âè∑</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               value="<%= typeof formData !== 'undefined' ? formData.phone || '' : '' %>">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">‰ΩèÊâÄ</label>
                                    <textarea class="form-control" id="address" name="address" rows="2"><%= typeof formData !== 'undefined' ? formData.address || '' : '' %></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="eventId" class="form-label">„Ç§„Éô„É≥„Éà <span class="required">*</span></label>
                                    <select class="form-control" id="eventId" name="eventId" required>
                                        <option value="">„Ç§„Éô„É≥„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <% if (typeof events !== 'undefined' && events.length > 0) { %>
                                            <% events.forEach(event => { %>
                                                <option value="<%= event.id %>" 
                                                        <%= (typeof formData !== 'undefined' && formData.eventId === event.id) ? 'selected' : '' %>
                                                        <%= !event.canApply ? 'disabled' : '' %>>
                                                    <%= event.title %> - <%= new Date(event.date).toLocaleDateString('ja-JP') %>
                                                    <% if (!event.canApply && event.applicationStartMessage) { %>
                                                        (<%= event.applicationStartMessage %>)
                                                    <% } %>
                                                </option>
                                            <% }); %>
                                        <% } %>
                                    </select>
                                    <% if (typeof events !== 'undefined' && events.some(event => !event.canApply)) { %>
                                        <div class="form-text text-info">
                                            Áî≥ËæºÈñãÂßãÂâç„ÅÆ„Ç§„Éô„É≥„Éà„ÅØÈÅ∏Êäû„Åß„Åç„Åæ„Åõ„Çì
                                        </div>
                                    <% } %>
                                </div>
                            </div>

                            <!-- Âá∫Â∫óÂÜÖÂÆπ -->
                            <div class="form-section">
                                <h5>üè™ Âá∫Â∫óÂÜÖÂÆπ</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="boothType" class="form-label">Âá∫Â∫óÂÜÖÂÆπ <span class="required">*</span></label>
                                        <select class="form-control" id="boothType" name="boothType" required>
                                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                            <option value="È£≤È£ü" <%= (typeof formData !== 'undefined' && formData.boothType === 'È£≤È£ü') ? 'selected' : '' %>>È£≤È£ü</option>
                                            <option value="Áâ©Ë≤©" <%= (typeof formData !== 'undefined' && formData.boothType === 'Áâ©Ë≤©') ? 'selected' : '' %>>Áâ©Ë≤©</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="boothCount" class="form-label">Â∏åÊúõÂá∫Â∫óÊû†Êï∞</label>
                                        <input type="number" class="form-control" id="boothCount" name="boothCount" min="1" max="5"
                                               value="<%= typeof formData !== 'undefined' ? formData.boothCount || '' : '' %>">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="items" class="form-label">Ë≤©Â£≤ÂìÅÁõÆ</label>
                                    <textarea class="form-control" id="items" name="items" rows="3" 
                                              placeholder="ÂÖ∑‰ΩìÁöÑ„Å™Ë≤©Â£≤ÂìÅÁõÆ„Çí„ÅîË®òÂÖ•„Åè„Å†„Åï„ÅÑ"><%= typeof formData !== 'undefined' ? formData.items || '' : '' %></textarea>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="priceRangeMin" class="form-label">‰æ°Ê†ºÂ∏ØÔºàÊúÄ‰Ωé‰æ°Ê†ºÔºâ</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="priceRangeMin" name="priceRangeMin" min="0"
                                                   value="<%= typeof formData !== 'undefined' ? formData.priceRangeMin || '' : '' %>">
                                            <span class="input-group-text">ÂÜÜ</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="priceRangeMax" class="form-label">‰æ°Ê†ºÂ∏ØÔºàÊúÄÈ´ò‰æ°Ê†ºÔºâ</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="priceRangeMax" name="priceRangeMax" min="0"
                                                   value="<%= typeof formData !== 'undefined' ? formData.priceRangeMax || '' : '' %>">
                                            <span class="input-group-text">ÂÜÜ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ë®≠Âñ∂„Éª„É¨„É≥„Çø„É´ -->
                            <div class="form-section">
                                <h5>‚õ∫ Ë®≠Âñ∂„Éª„É¨„É≥„Çø„É´ÊÉÖÂ†±</h5>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="tentWidth" class="form-label">„ÉÜ„É≥„ÉàÊ®™ÂπÖÔºàmÔºâ</label>
                                        <input type="number" class="form-control" id="tentWidth" name="tentWidth" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentWidth || '' : '' %>">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="tentDepth" class="form-label">„ÉÜ„É≥„ÉàÂ••Ë°åÔºàmÔºâ</label>
                                        <input type="number" class="form-control" id="tentDepth" name="tentDepth" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentDepth || '' : '' %>">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="tentHeight" class="form-label">„ÉÜ„É≥„ÉàÈ´ò„ÅïÔºàmÔºâ</label>
                                        <input type="number" class="form-control" id="tentHeight" name="tentHeight" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentHeight || '' : '' %>">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="rentalTables" class="form-label">„É¨„É≥„Çø„É´„ÉÜ„Éº„Éñ„É´Êï∞</label>
                                        <input type="number" class="form-control" id="rentalTables" name="rentalTables" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalTables || '' : '' %>">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="rentalChairs" class="form-label">„É¨„É≥„Çø„É´Ê§ÖÂ≠êÊï∞</label>
                                        <input type="number" class="form-control" id="rentalChairs" name="rentalChairs" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalChairs || '' : '' %>">
                                    </div>
                                </div>
                            </div>

                            <!-- Êê¨ÂÖ•Êê¨Âá∫ -->
                            <div class="form-section">
                                <h5>üöö Êê¨ÂÖ•Êê¨Âá∫</h5>
                                <div class="mb-3">
                                    <label for="vehicleCount" class="form-label">Êê¨ÂÖ•„ÉªÊê¨Âá∫Ëªä‰∏°Âè∞Êï∞</label>
                                    <input type="number" class="form-control" id="vehicleCount" name="vehicleCount" min="0"
                                           value="<%= typeof formData !== 'undefined' ? formData.vehicleCount || '' : '' %>">
                                    <div class="form-text">Ëªä‰∏°„Åß„ÅÆÊê¨ÂÖ•„ÉªÊê¨Âá∫„Çí‰∫àÂÆö„Åó„Å¶„ÅÑ„ÇãÂè∞Êï∞„Çí„ÅîË®òÂÖ•„Åè„Å†„Åï„ÅÑ</div>
                                </div>
                            </div>

                            <!-- ÈÄ£Áµ°‰∫ãÈ†Ö -->
                            <div class="form-section">
                                <h5>üí¨ ÈÄ£Áµ°‰∫ãÈ†Ö</h5>
                                <div class="mb-3">
                                    <label for="questions" class="form-label">„ÅîË≥™Âïè„Éª„ÅîË¶ÅÊúõÁ≠â</label>
                                    <textarea class="form-control" id="questions" name="questions" rows="4"
                                              placeholder="ÁâπÂà•„Å™ÈÖçÊÖÆ„ÅåÂøÖË¶Å„Å™‰∫ãÈ†Ö„ÄÅ„ÅîË≥™ÂïèÁ≠â„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÅîË®òÂÖ•„Åè„Å†„Åï„ÅÑ"><%= typeof formData !== 'undefined' ? formData.questions || '' : '' %></textarea>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="/apply" class="btn btn-secondary me-md-2">Êàª„Çã</a>
                                <button type="submit" class="btn btn-primary">Áî≥Ëæº„ÇÄ</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="py-3 mt-4">
        <div class="container text-center text-muted">
            <p>&copy; 2025 ËèäÂêçÊ°úÂ±±ÂÖ¨Âúí „Éú„É©„É≥„ÉÜ„Ç£„Ç¢ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>