<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .navbar-brand { font-weight: bold; color: #2d5a27 !important; }
        .bg-primary { background-color: #2d5a27 !important; }
        .btn-primary { background-color: #2d5a27; border-color: #2d5a27; }
        .btn-primary:hover { background-color: #1e3c1a; border-color: #1e3c1a; }
        footer { background-color: #f8f9fa; margin-top: auto; }
        .form-section { border-left: 4px solid #2d5a27; padding-left: 15px; margin-bottom: 2rem; }
        .required { color: #dc3545; }
        
        /* 出店申込用の薄い緑の背景 */
        .stall-form-bg {
            background-color: #e8f5e8;
        }
        .card-header.stall-header {
            background-color: #c8e6c9;
            border-bottom: 1px solid #a5d6a7;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">🌸 菊名桜山公園</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/register">ボランティア登録</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/apply">イベント申込</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin">管理画面</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header stall-header">
                        <h4 class="mb-0">🏪 出店申込フォーム</h4>
                        <small class="text-muted">応募要項A準拠</small>
                    </div>
                    <div class="card-body stall-form-bg">
                        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
                            <div class="alert alert-danger">
                                <ul class="mb-0">
                                    <% errors.forEach(error => { %>
                                        <li><%= error %></li>
                                    <% }); %>
                                </ul>
                            </div>
                        <% } %>

                        <form method="POST" action="/apply/stall">
                            <!-- 基本情報 -->
                            <div class="form-section">
                                <h5>📝 基本情報</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="groupName" class="form-label">参加団体名 <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="groupName" name="groupName" 
                                               value="<%= typeof formData !== 'undefined' ? formData.groupName || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="representative" class="form-label">代表者名 <span class="required">*</span></label>
                                        <input type="text" class="form-control" id="representative" name="representative" 
                                               value="<%= typeof formData !== 'undefined' ? formData.representative || '' : '' %>" required>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">メールアドレス <span class="required">*</span></label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               value="<%= typeof formData !== 'undefined' ? formData.email || '' : '' %>" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">電話番号</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               value="<%= typeof formData !== 'undefined' ? formData.phone || '' : '' %>">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">住所</label>
                                    <textarea class="form-control" id="address" name="address" rows="2"><%= typeof formData !== 'undefined' ? formData.address || '' : '' %></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="eventId" class="form-label">イベント <span class="required">*</span></label>
                                    <select class="form-control" id="eventId" name="eventId" required>
                                        <option value="">イベントを選択してください</option>
                                        <% if (typeof events !== 'undefined' && events.length > 0) { %>
                                            <% events.forEach(event => { %>
                                                <option value="<%= event.id %>" 
                                                        <%= (typeof formData !== 'undefined' && formData.eventId === event.id) ? 'selected' : '' %>
                                                        <%= !event.canApply ? 'disabled' : '' %>>
                                                    <%= event.title %> - <%= new Date(event.date).toLocaleDateString('ja-JP') %>
                                                    <% if (!event.canApply && event.applicationStartMessage) { %>
                                                        (<%= event.applicationStartMessage %>)
                                                    <% } %>
                                                </option>
                                            <% }); %>
                                        <% } %>
                                    </select>
                                    <% if (typeof events !== 'undefined' && events.some(event => !event.canApply)) { %>
                                        <div class="form-text text-info">
                                            申込開始前のイベントは選択できません
                                        </div>
                                    <% } %>
                                </div>
                            </div>

                            <!-- 出店内容 -->
                            <div class="form-section">
                                <h5>🏪 出店内容</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="boothType" class="form-label">出店内容 <span class="required">*</span></label>
                                        <select class="form-control" id="boothType" name="boothType" required>
                                            <option value="">選択してください</option>
                                            <option value="飲食" <%= (typeof formData !== 'undefined' && formData.boothType === '飲食') ? 'selected' : '' %>>飲食</option>
                                            <option value="物販" <%= (typeof formData !== 'undefined' && formData.boothType === '物販') ? 'selected' : '' %>>物販</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="boothCount" class="form-label">希望出店枠数</label>
                                        <input type="number" class="form-control" id="boothCount" name="boothCount" min="1" max="5"
                                               value="<%= typeof formData !== 'undefined' ? formData.boothCount || '' : '' %>">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="items" class="form-label">販売品目</label>
                                    <textarea class="form-control" id="items" name="items" rows="3" 
                                              placeholder="具体的な販売品目をご記入ください"><%= typeof formData !== 'undefined' ? formData.items || '' : '' %></textarea>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="priceRangeMin" class="form-label">価格帯（最低価格）</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="priceRangeMin" name="priceRangeMin" min="0"
                                                   value="<%= typeof formData !== 'undefined' ? formData.priceRangeMin || '' : '' %>">
                                            <span class="input-group-text">円</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="priceRangeMax" class="form-label">価格帯（最高価格）</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="priceRangeMax" name="priceRangeMax" min="0"
                                                   value="<%= typeof formData !== 'undefined' ? formData.priceRangeMax || '' : '' %>">
                                            <span class="input-group-text">円</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 設営・レンタル -->
                            <div class="form-section">
                                <h5>⛺ 設営・レンタル情報</h5>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="tentWidth" class="form-label">テント横幅（m）</label>
                                        <input type="number" class="form-control" id="tentWidth" name="tentWidth" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentWidth || '' : '' %>">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="tentDepth" class="form-label">テント奥行（m）</label>
                                        <input type="number" class="form-control" id="tentDepth" name="tentDepth" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentDepth || '' : '' %>">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="tentHeight" class="form-label">テント高さ（m）</label>
                                        <input type="number" class="form-control" id="tentHeight" name="tentHeight" step="0.1" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.tentHeight || '' : '' %>">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="rentalTables" class="form-label">レンタルテーブル数</label>
                                        <input type="number" class="form-control" id="rentalTables" name="rentalTables" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalTables || '' : '' %>">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="rentalChairs" class="form-label">レンタル椅子数</label>
                                        <input type="number" class="form-control" id="rentalChairs" name="rentalChairs" min="0"
                                               value="<%= typeof formData !== 'undefined' ? formData.rentalChairs || '' : '' %>">
                                    </div>
                                </div>
                            </div>

                            <!-- 搬入搬出 -->
                            <div class="form-section">
                                <h5>🚚 搬入搬出</h5>
                                <div class="mb-3">
                                    <label for="vehicleCount" class="form-label">搬入・搬出車両台数</label>
                                    <input type="number" class="form-control" id="vehicleCount" name="vehicleCount" min="0"
                                           value="<%= typeof formData !== 'undefined' ? formData.vehicleCount || '' : '' %>">
                                    <div class="form-text">車両での搬入・搬出を予定している台数をご記入ください</div>
                                </div>
                            </div>

                            <!-- 連絡事項 -->
                            <div class="form-section">
                                <h5>💬 連絡事項</h5>
                                <div class="mb-3">
                                    <label for="questions" class="form-label">ご質問・ご要望等</label>
                                    <textarea class="form-control" id="questions" name="questions" rows="4"
                                              placeholder="特別な配慮が必要な事項、ご質問等がございましたらご記入ください"><%= typeof formData !== 'undefined' ? formData.questions || '' : '' %></textarea>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="/apply" class="btn btn-secondary me-md-2">戻る</a>
                                <button type="submit" class="btn btn-primary">申込む</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="py-3 mt-4">
        <div class="container text-center text-muted">
            <p>&copy; 2025 菊名桜山公園 ボランティア管理システム</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>