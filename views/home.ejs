<%- include('partials/header', { title }) %>

<main>
  <!-- ヒーロー -->
  <section class="container my-5">
    <h1 class="mb-3">菊名桜山公園 ボランティア募集</h1>
    <p class="lead">地域の自然と文化を守り、育てる活動にご参加ください</p>

    <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-3">
      <% if (upcomingEvents && upcomingEvents.length > 0) { %>
        <!-- 直近イベントに紐づいた3ボタン -->
        <a href="/register" class="btn btn-volunteer btn-lg me-md-2">🙋 ボランティア登録</a>
        <a href="/apply/<%= upcomingEvents[0].slug %>/stall" class="btn btn-stall btn-lg me-md-2">🏪 出店申込</a>
        <a href="/apply/<%= upcomingEvents[0].slug %>/performer" class="btn btn-performer btn-lg">🎭 出演申込</a>
      <% } else { %>
        <!-- イベントがない場合は申込系を無効化 -->
        <a href="/register" class="btn btn-volunteer btn-lg me-md-2">🙋 ボランティア登録</a>
        <button class="btn btn-stall btn-lg me-md-2" disabled>🏪 出店申込（準備中）</button>
        <button class="btn btn-performer btn-lg" disabled>🎭 出演申込（準備中）</button>
      <% } %>
    </div>

    <% if (upcomingEvents && upcomingEvents.length > 0) { %>
      <% if (!upcomingEvents[0].applicationStartDate || new Date(upcomingEvents[0].applicationStartDate) <= new Date()) { %>
        <a href="/apply/<%= upcomingEvents[0].slug %>" class="btn btn-view-all btn-lg">イベント申込</a>
      <% } else { %>
        <button class="btn btn-view-all btn-lg" disabled>
          申込開始：<%= new Date(upcomingEvents[0].applicationStartDate).toLocaleDateString('ja-JP') %>
        </button>
      <% } %>
    <% } else { %>
      <button class="btn btn-view-all btn-lg" disabled>イベント申込（準備中）</button>
    <% } %>
  </section>

  <!-- 募集中のイベント一覧 -->
  <section class="container my-5">
    <h2 class="mb-4">募集中のイベント</h2>

    <% if (upcomingEvents && upcomingEvents.length > 0) { %>
      <div class="row">
        <% upcomingEvents.forEach(function(event){ %>
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title"><%= event.title %></h5>
                <p class="card-text">
                  開催日：<%= new Date(event.date).toLocaleDateString('ja-JP') %><br>
                  会場：<%= event.location || '未定' %>
                </p>

                <% if (!event.applicationStartDate || new Date(event.applicationStartDate) <= new Date()) { %>
                  <a href="/apply/<%= event.slug %>" class="btn btn-primary w-100">申し込む</a>
                <% } else { %>
                  <button class="btn btn-secondary w-100" disabled>
                    申込開始：<%= new Date(event.applicationStartDate).toLocaleDateString('ja-JP') %>
                  </button>
                <% } %>
              </div>
            </div>
          </div>
        <% }); %>
      </div>
    <% } else { %>
      <p class="text-muted">現在募集中のイベントはありません。</p>
    <% } %>
  </section>
</main>

<%- include('partials/footer') %>
