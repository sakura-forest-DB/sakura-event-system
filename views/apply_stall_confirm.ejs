<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f7fdf8; }
    .navbar-brand { font-weight: bold; color: #2d5a27 !important; }
    .btn-success { background-color: #2d5a27; border-color: #2d5a27; }
    .btn-success:hover { background-color: #1e3c1a; border-color: #1e3c1a; }
    .form-section { border-left: 4px solid #2d5a27; padding-left: 15px; margin-bottom: 2rem; }
    footer { background-color: #f8f9fa; margin-top: auto; }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/">ğŸŒ¸ èŠåæ¡œå±±å…¬åœ’</a>
    </div>
  </nav>

  <main class="container my-4 flex-grow-1">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="card shadow-sm">
          <div class="card-header bg-success text-white">
            <h4 class="mb-0">ğŸª å‡ºåº—ç”³è¾¼å†…å®¹ç¢ºèª</h4>
            <small class="text-light">å†…å®¹ã‚’ã”ç¢ºèªã®ä¸Šã€ã€Œâœ… å†…å®¹ç¢ºèªå¾Œã€é€ä¿¡ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</small>
          </div>

          <div class="card-body">

            <% 
              // ====== å€¤ã®ãƒ˜ãƒ«ãƒ‘ ======
              const D = formData || {};
              const pick = (...keys) => {
                for (const k of keys) { if (D && D[k] != null && String(D[k]).trim() !== '') return String(D[k]); }
                return '';
              };
              const show = (v, fallback='æœªå…¥åŠ›') => (v && String(v).trim() !== '' ? v : fallback);
              const yn   = (v) => (v ? 'åŒæ„æ¸ˆã¿' : 'â€”');

              // ä»£è¡¨çš„ãªåˆ¥åã«ã‚‚å¯¾å¿œï¼ˆæ—§/æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸¡å¯¾å¿œï¼‰
              const groupName   = pick('groupName','orgName','name');
              const representative = pick('representative','contactName');
              const email       = pick('email');
              const phone       = pick('phone','tel');
              const address     = pick('address');

              // å‡ºåº—è©³ç´°
              const boothType   = pick('boothType','stallType');          // é£²é£Ÿ/ç‰©è²© ãªã©
              const boothCount  = pick('boothCount','plotCount','blockCount');
              const stallContent= pick('stallContent','content','description');
              const salesItems  = pick('salesItems','items');
              const priceMin    = pick('priceRangeMin','priceMin');
              const priceMax    = pick('priceRangeMax','priceMax');

              // ãƒ¬ãƒ³ã‚¿ãƒ«é¡
              const rentalTables = pick('rentalTables','tables');
              const rentalChairs = pick('rentalChairs','chairs');

              // ãã®ä»–
              const questions   = pick('questions','requests','notes');

              // åŒæ„
              const privacyConsent   = !!(D.privacyConsent || D.agreePrivacy);
              const marketingConsent = !!(D.marketingConsent || D.agreePublicity);
            %>

            <!-- åŸºæœ¬æƒ…å ± -->
            <div class="form-section">
              <h5>ğŸ“ åŸºæœ¬æƒ…å ±</h5>
              <dl class="row mb-0">
                <dt class="col-4 col-sm-3">å‚åŠ å›£ä½“å</dt>
                <dd class="col-8 col-sm-9"><%= show(groupName) %></dd>

                <dt class="col-4 col-sm-3">ä»£è¡¨è€…å</dt>
                <dd class="col-8 col-sm-9"><%= show(representative) %></dd>

                <dt class="col-4 col-sm-3">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</dt>
                <dd class="col-8 col-sm-9"><%= show(email) %></dd>

                <dt class="col-4 col-sm-3">é›»è©±ç•ªå·</dt>
                <dd class="col-8 col-sm-9"><%= show(phone) %></dd>

                <dt class="col-4 col-sm-3">ä½æ‰€</dt>
                <dd class="col-8 col-sm-9"><%= show(address,'â€”') %></dd>
              </dl>
            </div>

            <!-- å‡ºåº—å†…å®¹ -->
            <!-- å‡ºåº—å†…å®¹ -->
<div class="form-section">
  <h5>ğŸ·ï¸ å‡ºåº—å†…å®¹</h5>

  <% if (formData && Object.keys(formData).length) { %>
    <div class="mt-3 p-3 border rounded bg-white">
      <h6 class="mb-3">ğŸ›ï¸ å…¥åŠ›å†…å®¹ã®ç¢ºèª</h6>

      <%
      // ====== ãƒ©ãƒ™ãƒ«ãƒ»å˜ä½ãƒ»æ•´å½¢ ======
      const LABELS = {
        groupName: 'å‚åŠ å›£ä½“å',
        representative: 'ä»£è¡¨è€…å',
        address: 'ä½æ‰€',
        email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
        phone: 'é›»è©±ç•ªå·',

        boothType: 'å‡ºåº—ç¨®åˆ¥',
        boothCount: 'å¸Œæœ›åŒºç”»æ•°',
        items: 'è²©å£²å“ç›®',
        priceRangeMin: 'ä¾¡æ ¼å¸¯ï¼ˆæœ€å°ï¼‰',
        priceRangeMax: 'ä¾¡æ ¼å¸¯ï¼ˆæœ€å¤§ï¼‰',
        rentalTables: 'ãƒ¬ãƒ³ã‚¿ãƒ«æœº',
        rentalChairs: 'ãƒ¬ãƒ³ã‚¿ãƒ«æ¤…å­',

        vehicleType: 'è»Šä¸¡ã‚¿ã‚¤ãƒ—',
        vehicleCount: 'è»Šä¸¡å°æ•°',
        vehicleNumbers: 'è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼',
        questions: 'é€£çµ¡äº‹é …',

        privacyConsent: 'å€‹äººæƒ…å ±ã®å–æ‰±ã„ã«åŒæ„',
        marketingConsent: 'åºƒå ±ç­‰ã§ã®ä½¿ç”¨ã«åŒæ„'
      };

      const data = { ...formData };
      data.items      = data.items      || data.salesItems; // è²©å£²å“ç›®
      data.boothCount = data.boothCount || data.plotCount || data.blockCount;

      const UNITS = { boothCount: 'æ ', priceRangeMin: 'å††', priceRangeMax: 'å††', vehicleCount: 'å°' };
      const HIDE  = new Set(['_csrf']);

      function fmt(key, val) {
        if (val == null) return '';
        if (Array.isArray(val)) return val.filter(s => String(s).trim() !== '').join('ã€');
        const s = String(val).trim();
        if (!s) return '';
        return UNITS[key] ? `${s}${UNITS[key]}` : s;
      }

      const ORDER = [
        'groupName','representative','email','phone','address',
        'boothType','boothCount','items',
        'priceRangeMin','priceRangeMax',
        'rentalTables','rentalChairs',
        'vehicleType','vehicleCount','vehicleNumbers',
        'questions',
        'privacyConsent','marketingConsent'
      ];
      %>

      <dl class="row mb-0 dl-2col">
        <% ORDER.forEach((k) => {
             if (HIDE.has(k)) return;
             if (!(k in data)) return;
             const txt = fmt(k, data[k]);
             if (!txt) return;
        %>
          <dt class="col-5 col-md-4"><%= LABELS[k] || k %></dt>
          <dd class="col-7 col-md-8"><%= txt %></dd>
        <% }) %>

        <% // ãã®ä»–ã®ã‚­ãƒ¼ã‚‚è¡¨ç¤ºã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã‚’ON
           Object.keys(data).forEach((k) => {
             if (HIDE.has(k)) return;
             if (ORDER.includes(k)) return;
             const txt = fmt(k, data[k]);
             if (!txt) return;
        %>
          <dt class="col-5 col-md-4"><%= LABELS[k] || k %></dt>
          <dd class="col-7 col-md-8"><%= txt %></dd>
        <% }) %>
      </dl>
    </div>
  <% } %>
</div>

            <!-- ç¢ºèªãƒ»é€ä¿¡ãƒœã‚¿ãƒ³ -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
              <!-- æˆ»ã£ã¦ä¿®æ­£ï¼šGETã§å…¥åŠ›ç”»é¢ã¸ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³è‰ç¨¿ã‚’å¾©å…ƒã—ã¦å†è¡¨ç¤ºï¼‰ -->
              <form method="GET" action="/apply/<%= event.slug %>/stall" class="me-md-2">
                <button type="submit" class="btn btn-secondary">âœï¸ æˆ»ã£ã¦ä¿®æ­£</button>
              </form>

              <!-- é€ä¿¡ï¼šPOSTã§ /submit -->
              <form method="POST" action="/apply/<%= event.slug %>/stall/submit">
                <button type="submit" class="btn btn-success">âœ… å†…å®¹ç¢ºèªå¾Œã€é€ä¿¡ã™ã‚‹</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-3 mt-4">
    <div class="container text-center text-muted">
      <p>&copy; 2025 èŠåæ¡œå±±å…¬åœ’ ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>