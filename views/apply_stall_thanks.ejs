<%- include('partials/header', { title: (event?.title || 'イベント') + ' - 出店申込 完了' }) %>

<!-- ▼印刷対象 -->
<div class="print-area">

<main class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body py-4">

          <!-- 見出し -->
          <h3 class="fw-bold text-center mb-3">🎉 出店申込が完了しました</h3>
          <p class="text-center mb-4">
            <strong><%= event?.title || 'イベント' %></strong> への出店申込を受け付けました。
          </p>

          <!-- ご注意 -->
          <div class="alert alert-warning" role="alert">
            <strong>ご注意ください：</strong>
            この申込は <u>仮受付</u> です。正式な決定ではありません。後日、主催者（菊名桜山公園愛護会）からの連絡をもって確定となります。
          </div>

          <!-- 申込控えのお願い -->
          <div class="alert alert-info" role="alert">
            <div class="d-flex align-items-start gap-2">
              <div>📝</div>
              <div>
                <strong>申込控えの保存をお願いします。</strong><br>
                下の「印刷する」ボタンで、この完了画面を印刷（またはPDF保存／スクリーンショット）してください。<br>
                （控えがないと後日の確認が難しくなる場合があります）
              </div>
            </div>
          </div>

          <!-- 受付番号（あれば表示） -->
          <% if (typeof applicationNumber !== 'undefined' && applicationNumber) { %>
            <p class="text-muted text-center">受付番号：
              <strong><%= applicationNumber %></strong>
            </p>
          <% } else if (application?.receiptNo) { %>
            <p class="text-muted text-center">受付番号：
              <strong><%= application.receiptNo %></strong>
            </p>
          <% } else if (application?.id) { %>
            <p class="text-muted text-center">受付ID：
              <strong><%= application.id %></strong>
            </p>
          <% } %>

          <!-- イベント情報 -->
          <div class="mt-4 p-3 border rounded">
            <h5 class="mb-3">📄 イベント情報</h5>
            <dl class="row mb-0">
              <dt class="col-4 col-sm-3">イベント</dt>
              <dd class="col-8 col-sm-9"><%= event?.title || '—' %></dd>

              <dt class="col-4 col-sm-3">開催日</dt>
              <dd class="col-8 col-sm-9"><%= event?.date ? new Date(event.date).toLocaleDateString('ja-JP') : '—' %></dd>

              <dt class="col-4 col-sm-3">場所</dt>
              <dd class="col-8 col-sm-9"><%= event?.location || '菊名桜山公園' %></dd>
            </dl>
          </div>

          <!-- 申込内容（自動マッピング） -->
          <% if (application && Object.keys(application).length) { %>
  <div class="mt-4 p-3 border rounded">
    <h5 class="mb-3">🛍️ 申込内容</h5>
    <dl class="row mb-0 dl-2col">
      <%
        // 非表示にするキー
        const HIDE = new Set(['_csrf', 'eventId']);

        // キー → 表示ラベル
        const LABELS = {
          groupName: '参加団体名',
  representative: '代表者名',
  address: '住所',
  email: 'メールアドレス',
  phone: '電話番号',

  boothType: '出店種別',
  boothCount: '希望区画数',
  items: '販売品目',
  priceRangeMin: '価格帯（最小）',
  priceRangeMax: '価格帯（最大）',
  rentalTables: 'レンタル机',
  rentalChairs: 'レンタル椅子',

  vehicleType: '車両タイプ',
  vehicleCount: '車両台数',
  vehicleNumbers: '車両ナンバー',
  questions: '連絡事項',

  privacyConsent: '個人情報の取扱いに同意',
  marketingConsent: '広報等での使用に同意',
        };

        // 数値に単位を付けたいキー
        const UNITS = {
          boothCount:    '枠',
          rentalTables:  '台',
          rentalChairs:  '脚',
        };

        for (const [k, raw] of Object.entries(application)) {
          if (HIDE.has(k)) continue;

          // 値の整形
          let v = Array.isArray(raw) ? raw.join(', ') : (raw ?? '');
          if (String(v).trim() === '') continue;
          if (v === 'on') v = '同意する';
          if (UNITS[k] && /^\d+$/.test(String(v))) v = `${v} ${UNITS[k]}`;
      %>
        <dt class="col-5 col-sm-4"><%= LABELS[k] || k %></dt>
        <dd class="col-7 col-sm-8"><%= v %></dd>
      <% } %>
    </dl>
  </div>
<% } %>

          <!-- 今後の流れ -->
          <div class="mt-4 p-3 border rounded bg-light">
            <h5 class="mb-3">📬 今後の流れ</h5>
            <ul class="mb-2">
              <li>申込内容を確認の上、菊名桜山公園愛護会担当者よりご連絡いたします。</li>
              <li>詳細な打合せ等は別途調整させていただきます。</li>
              <li>ご質問がございましたら、下記メールアドレスまでお気軽にお問い合わせください。</li>
            </ul>
            <p class="mb-0 text-center">
              📧 <a href="mailto:osawa-s@nifty.com">osawa-s@nifty.com</a>
            </p>
          </div>

          <!-- 操作ボタン（印刷/トップ/申込トップへ） -->
          <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4 no-print">
            <button type="button" class="btn btn-outline-secondary" onclick="window.print()">🖨️ 印刷する</button>
            <a href="/" class="btn btn-view-all">🏠 トップへ</a>
            <% if (event?.slug) { %>
              <a href="/apply/<%= event.slug %>" class="btn btn-stall">📋 申込トップへ</a>
            <% } %>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>

</div>
<!-- ▲印刷対象ここまで -->

<!-- 印刷用スタイル -->
<style>
@media print {
  @page { margin: 12mm; }

  /* 既存の印刷制御 */
  body * { visibility: hidden !important; }
  .print-area, .print-area * { visibility: visible !important; }
  .print-area { position: static !important; }
  nav, footer { display: none !important; }
  .btn, .no-print { display: none !important; }
  .card { box-shadow: none !important; border: none !important; }
  .container { max-width: 900px; }
  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

  /* ▼ ここから追加（折り返し改善＆列幅固定） */
  .dl-2col dt { white-space: nowrap; }
  .dl-2col { display: flex; flex-wrap: wrap; }
  .dl-2col dt { flex: 0 0 35%; max-width: 35%; }
  .dl-2col dd { flex: 0 0 65%; max-width: 65%; word-break: break-word; }
  /* ▲ ここまで追加 */
}
</style>

<%- include('partials/footer') %>